<!DOCTYPE html>
<html>
	<head>
		<meta class="no-js" lang="fr">
		<meta charset="UTF-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge"/>
		<title>TripToGo - Agence de voyages et rÃ©servation de circuits</title>
		<meta name="author" content="vecuro"/>
		<meta name="description" content="Travolo - Travel Agency & Tour Booking HTML Template"/>
		<meta name="keywords" content="Travolo - Travel Agency & Tour Booking HTML Template"/>
		<meta
		name="robots" content="INDEX,FOLLOW"/>

		<!-- Mobile Specific Metas -->
		<meta
		name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>

		<!-- Favicons -->
		<link rel="icon" type="image/png" href="{{ asset('assets/img/primary.png') }}"/>
		<meta name="msapplication-TileColor" content="#ffffff"/>
		<meta name="theme-color" content="#ffffff"/>


		{% block stylesheets %}
			<!--==============================
																																																																																																																																																																																																																																																																																																			        All CSS Files
																																																																																																																																																																																																																																																																																																			      ==============================-->
			<link rel="stylesheet" href="{{ asset('assets/css/bootstrap.min.css') }}"/>
			<link rel="stylesheet" href="{{ asset('assets/css/fontawesome.min.css') }}"/>
			<link rel="stylesheet" href="{{ asset('assets/css/magnific-popup.min.css') }}"/>
			<link rel="stylesheet" href="{{ asset('assets/css/slick.min.css') }}"/>
			<link rel="stylesheet" href="{{ asset('assets/css/style.css') }}"/>
			<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"/>
			<link rel="preconnect" href="https://fonts.googleapis.com"/>
			<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
			<link href="https://fonts.googleapis.com/css2?family=Jost:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>


			<style>
				/* Fond plein Ã©cran avec opacitÃ© */
				.chat-overlay {
					position: fixed;
					inset: 0;
					background: rgba(0, 0, 0, 0.85);
					z-index: 9999;
					display: flex; /* visible par dÃ©faut ici pour test, Ã  cacher dynamiquement sinon */
					justify-content: center;
					align-items: flex-end; /* ancrer le chat en bas */
					transition: all 0.3s ease-in-out;
					padding-left: 20px;
				}

				/* === FenÃªtre de chat en bas === */
				.chat-window {
					width: 100%;
					border-radius: 20px 20px 0 0;
					box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
					display: flex;
					flex-direction: column;
					padding: 15px;
					margin-bottom: 20px;
				}

				/* === Messages === */
				.chat-messages {
					flex: 1;
					max-height: 600px;
					overflow-y: auto;
					color: #eee;
					padding: 100px 0 100px 250px;
					margin-bottom: 10px;

				}

				.chat-message {
					padding: 10px 15px;
					border-radius: 20px;
					margin-bottom: 10px;
					max-width: 50%;
					word-wrap: break-word;
				}

				.chat-message.user {
					background: #ff681a;
					color: #fff;
					align-self: flex-end;
					text-align: right;
				}

				.chat-message.bot {
					background: #444;
					color: #eee;
					align-self: flex-start;
					text-align: left;
				}

				/* === Formulaire === */
				.chat-form {
					display: flex;
					gap: 10px;
					justify-content: center;
					align-items: center;
				}

				.chat-form input {
					font-size: 14px;
					height: 70px;
					width: 100%;
					border: 2px solid var(--theme-color);
					background-color: transparent;
					color: #fff;
					border-radius: 50px;
					position: fixed;
					top: 120px;
					left: 50%;
					transform: translateX(-50%);
					z-index: 10000 !important;
				}


				.chat-form button {
					background: #ff681a;
					color: white;
					border: none;
					padding: 10px 20px;
					border-radius: 25px;
					font-weight: bold;
					cursor: pointer;
					transition: background 0.3s ease;
				}


				/* === Responsive === */
				@media(max-width: 600px) {
					.chat-window {
						width: 95%;
					}
				}


				.input-group {
					position: relative;
					display: flex;
					align-items: center;
					width: 100%;
				}

				.input-group-append {
					position: absolute;
					right: 10px;
					display: flex;
					align-items: center;
					justify-content: center;
				}

				.input-group-text {
					cursor: pointer;
					background-color: transparent;
					border: none;
					display: flex;
					justify-content: center;
					align-items: center;
					padding: 0;
					height: 100%;
					width: 30px; /* Ajuster la largeur de l'icÃ´ne pour Ãªtre plus petite */
				}

				#eyeIcon {
					font-size: 18px; /* Ajuste la taille de l'icÃ´ne */
					color: #ccc; /* Couleur de l'icÃ´ne */
				}


				#loading-screen {
					position: fixed;
					top: 0;
					left: 0;
					width: 100%;
					height: 100%;
					background-color: #fff;
					z-index: 9999;
					display: flex;
					align-items: center;
					justify-content: center;
				}
				.spinner {
					border: 8px solid #f3f3f3;
					border-top: 8px solid #ff681a;
					border-radius: 50%;
					width: 60px;
					height: 60px;
					animation: spin 1s linear infinite;
				}
				@keyframes spin {
					0% {
						transform: rotate(0deg);
					}
					100% {
						transform: rotate(360deg);
					}
				}
			</style>


		{% endblock %}


	</head>

	<body>
		<div id="loading-screen">
			<div class="spinner"></div>
		</div>
		{{ include('includes/header.html.twig')  }}

		{% block body %}{% endblock %}
		{% block javascripts %}
			<!--==============================
																																																																																																																																																																																																																																																																																																				        All JS Files
																																																																																																																																																																																																																																																																																																				      ==============================-->
			<script src="{{ asset('assets/js/vendor/jquery-3.6.0.min.js') }}"></script>
			<script src="{{ asset('assets/js/slick.min.js') }}"></script>
			<script src="{{ asset('assets/js/bootstrap.min.js') }}"></script>
			<script src="{{ asset('assets/js/jquery.magnific-popup.min.js') }}"></script>
			<script src="{{ asset('assets/js/jquery-ui.min.js') }}"></script>
			<script src="{{ asset('assets/js/circle-progress.min.js') }}"></script>
			<script src="{{ asset('assets/js/imagesLoaded.js') }}"></script>
			<script src="{{ asset('assets/js/isotope.js') }}"></script>
			<script src="{{ asset('assets/js/wow.min.js') }}"></script>
			<script src="{{ asset('assets/js/main.js') }}"></script>
			<script src="{{ asset('assets/js/vendor/jquery-3.6.0.min.js') }}"></script>
			<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
			<script>
				window.addEventListener("load", function () {
setTimeout(function () {
fetch("{{ path('app_logout') }}", {
method: 'POST',
headers: {
'X-Requested-With': 'XMLHttpRequest'
}
}).then(response => {
if (response.ok) {
window.location.href = "{{ path('app_home') }}";
} else {
console.log("Erreur lors de la dÃ©connexion.");
}
}).catch(error => {
console.error("Erreur de requÃªte AJAX:", error);
});
}, 1800000);
});
			</script>
			<script>
				toastr.options = {
"closeButton": true,
"progressBar": true,
"positionClass": "toast-top-right",
"timeOut": "5000"
};{% for label, messages in app.flashes %}{% for message in messages %}toastr["{{ label }}"]("{{ message }}");{% endfor %}{% endfor %}
			</script>


			<script>
				// Hide the loading screen when the page has loaded
window.addEventListener('load', function () {
var loadingScreen = document.getElementById('loading-screen');
if (loadingScreen) {
loadingScreen.style.display = 'none';
}
});
			</script>
			<script>
				function toggleChatWindow() {
const chatWindow = document.getElementById("chat-window");
}

// Afficher un message dans la fenÃªtre de chat
function appendMessage(sender, message) {
const chatMessages = document.getElementById("chat-messages");
const messageDiv = document.createElement("div");
messageDiv.classList.add("chat-message", sender);
messageDiv.textContent = message;
chatMessages.appendChild(messageDiv);
chatMessages.scrollTop = chatMessages.scrollHeight;
}

let lastQuestion = "";

async function sendMessage(event) {
event.preventDefault();

const input = document.getElementById("user-question");
const message = input.value.trim();

if (! message || message === lastQuestion) 
return;



lastQuestion = message;

appendMessage("user", message);

try {
const response = await fetch("http://localhost:5000/ask-chatbot", {
method: "POST",
headers: {
"Content-Type": "application/json"
},
body: JSON.stringify(
{question: message}
)
});

if (response.ok) {
const data = await response.json();
appendMessage("bot", data.answer || "Je nâ€™ai pas compris. Pouvez-vous reformuler ?");
} else {
appendMessage("bot", "Erreur serveur. Essayez plus tard.");
}
} catch (error) {
console.error("Erreur:", error);
appendMessage("bot", "Connexion impossible. Veuillez rÃ©essayer.");
}

input.value = "";
}

document.addEventListener("DOMContentLoaded", () => {
appendMessage("bot", "ðŸ‘‹ Bonjour ! Comment puis-je vous aider ?");
});

document.getElementById("chat-form").addEventListener("submit", sendMessage);
document.getElementById("user-question").addEventListener("keypress", function (e) {
if (e.key === "Enter") {
sendMessage(e);
}
});
			</script>

		{% endblock %}
		{{ include('includes/footer.html.twig')  }}</body>
</html></body></html>
